---
title: "Final Paper Exploratory Data Analysis"
author: "Alfredo Rojas"
date: "3/10/2020"
output:
  github_document: default
  html_document: default
---


## Final Project for PLAN 672: Initial Summary

This project will explore the relationship between food insecurity indicators in West Africa and relevant environmental and household-related variables. This preliminary paper will rely on DHS survey data. For this specific analysis, the survey data is restricted to 2011 since the DHS standardizes all their variables across survey years, i.e. the variables all have the similar code names for easy comparison. 

At the outset, vaiables related to food security, according to Gubert, et al. (2010) are: per capital income, years of schooling, race and gender of HH head, urban/rural residence, access to public water supply, presence of children, total number of household inhabitants, and state of residence. 

This particular project will begin exploring some of these variables within the DHS data. Later, I will try to incorporte othr related variables, such as land-use/land-cover change, NDVI, and/or climate data. As I explore the literature in more detail, I will determine what will be a feasible route to take for this final project. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

Let's explore some of the variables in the data and see what may be of interest. Later, I will bring up what variables are commonly used in the literature and whether they are present in this particular dataset. The first thing I wanted to look for were differences between rural and urban households. This distinction will be important to see what kinds of variables impact food security indicators. For example, does living in rural or urban settings impact food security measures? If so, to what extent? These are some of the questions I begin asking as I explore the DHS data to see what variables I'm able to work with. 

The `haven` package allows R to read and interpret data stored in .DTA format. In this format, categorical variables are 
stored as `haven_labelled` class, meaning the categorical variables used in observations correspond to label names. You can insert these label names using the `haven::as_factor()` function, as seen in the `ggplot` code chunk. 

```{r}

path_name = file.path("CI_Data", "CI_2011-12_DHS_12102019_1545_134297", "CIHR62DT", "")

library(haven)
library(tidyverse)
```


```{r}

# Read in Household-level data.
hhci = read_dta(paste0(path_name, "CIHR62FL.DTA"))
head(hhci)

# number of cases
NROW(hhci)

```

I am going to create a subset data frame to explore some immediate variables of interest. Note the use of `as_factor()` in the `ggplot()` function. 

```{r}
# view average field size, hv012 (# of hh members), hv025 (urban or rural?), hv244 (has ag land), hv245 (ag land in ha)
subset_hh = hhci %>%
  select(hhid, hv012, hv025, hv244, hv245, hv270) %>%
  rename("num_hh_mem" = hv012, "urban_rural" = hv025, "owns_land" = hv244, "ag_area" = hv245, "wealth_index" = hv270)

# compare urban/rural numbers, 1 = urbn, 2 = rural
subset_hh %>%
  group_by(urban_rural) %>%
  summarise(n = n()) %>%
  ggplot(aes(x = as_factor(urban_rural), y = n)) + # as_factor a `haven` function, uses labels for categorical responses
  geom_bar(stat = "identity")

# ggsave("rural_urban_bar.png", dpi = 300)

```

![bar plot](rural_urban_bar.png)

I can start looking at the distribution of certain variables of interest. Let me start with number of household members per each household observed. 

```{r}

ggplot(subset_hh, aes(num_hh_mem)) +
  geom_density()

# ggsave("hh_density.png", dpi = 300)
```

![hh_density](hh_density.png)

Now, I'll look at agricultural area in hectares for each household that has a farm.

```{r}
d2 = subset_hh %>%
  filter(is.na(ag_area) != TRUE) %>%
  select(ag_area)

ggplot(d2, aes(ag_area)) +
  geom_density()

# ggsave("ag_dens.png", dpi = 300)
```

![density1](ag_dens.png)

Also, I can look at the relationship between the two variables. 
```{r}

# plot houehold member number by agri area
subset_hh %>%
  ggplot(aes(x = num_hh_mem, y = ag_area)) +
  geom_point() +
  geom_smooth(method = "loess")

# ggsave("ag_hh_compare.png", dpi = 300)
```

![compare1](ag_hh_compare.png)

The DHS has another variable that may be of interest: Wealth Index. This index apparently measures the relative wealth of households and categorizes them into quintiles. 
```{r}
# plot wealth vs. agricultural area
subset_hh %>%
  ggplot(aes(x = wealth_index, y = ag_area)) +
  geom_col(aes(fill = as_factor(wealth_index)))

# ggsave("ag_wealth.png", dpi = 300)
```

![barplot2](ag_wealth.png)

One thing that may be of interest is looking at the distribution of agricultural area by wealth category to see variation within a variable. The spread of the data is interesting. The different catgories seem to follow a similar pattern but in different magnitudes. 

```{r}

# compare distribution of agricultural area across wealth indices
subset_hh %>%
  ggplot(aes(x = ag_area, colour = as_factor(wealth_index))) +
  geom_freqpoly(binwidth = 50)

# ggsave("ag_wealth_density.png", dpi = 300)
```

![density2](ag_wealth_density.png)

From this analysis, I will rely on the availale DHS data variables to understnd their impact on food security. Food security indicators will be chosen in the days to come. One indicator may include child stunting, nutrition, or maternal health variables. In the days to come, I will update this RMarkdown with more exploratory data analysis (EDA). 


